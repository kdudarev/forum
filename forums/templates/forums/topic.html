{% extends "layout/base.html" %}

{% load bootstrap4 %}

{% block page_header %}
    <h1>{{ topic }}</h1>
{% endblock page_header %}

{% block content %}
    {% if request.user == topic.owner %}
        <p><a href="{% url 'forums:edit_topic' topic.id topic.slug%}">
                Edit topic</a></p>
    {% endif %}

    <p><i>Posted by: {{ topic.owner }}
        {{ topic.date_added|date:'d.m.Y H:i:s' }}</i></p>
    <h5>{{ topic.text|linebreaks }}</h5>
    <p><i>{{ topic.comment_set.count }}
        Comment{{ topic.comment_set.count|pluralize }}</i></p>

    <p><b>Comment as <ins>{{ user.username }}</ins>:</b></p>

    <form action="." method="post" class="form" id="formComment">
        {% csrf_token %}
        <input type="hidden" name="parent" id="contactparent" value="">
        <textarea cols="80" rows="6" name="text"
                  id="contactcomment" required=""></textarea>
        {% buttons %}
            <button name="submit" class="btn btn-primary">Add comment</button>
        {% endbuttons %}
    </form>

    {% for comment in topic.get_comment %}
        <p><i>Posted by: {{ comment.owner }}
            {{ comment.date_added|date:'d.m.Y H:i:s' }}</i></p>
        <h5>{{ comment.text|linebreaks }}</h5>
        <p></p><a href="#formComment" onclick="addComment('{{ comment.owner }}',
        '{{ comment.id }}')">Reply</a></p>
        {% for c in comment.comment_set.all %}
            <ul>
                <p><i>Posted by: {{ c.owner }}
                {{ c.date_added|date:'d.m.Y H:i:s' }}</i></p>
                <h5>{{ c.text|linebreaks }}</h5>
            </ul>
        {% endfor %}
    {% empty %}
        <h5>No comment have been added yet.</h5>
    {% endfor %}

    <script>
        function addComment(owner, id) {
            document.getElementById("contactparent").value = id;
            document.getElementById("contactcomment").innerText = `${owner}, `
        }
    </script>
{% endblock content %}